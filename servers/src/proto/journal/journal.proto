package tachyon.proto.journal;
option java_package = "tachyon.proto.journal";

// Wraps around all types of Tachyon journal messages.
// next available id: 25
message JournalEntry {
  optional int64 sequence_number = 1;
  oneof entry {
    AddMountPointEntry add_mount_point = 2;
    AsyncCompleteFileEntry async_complete_file = 3;
    BlockContainerIdGeneratorEntry block_container_id_generator = 4;
    BlockInfoEntry block_info = 5;
    CompleteFileEntry complete_file = 6;
    DeleteFileEntry delete_file = 7;
    DeleteLineageEntry delete_lineage = 8;
    DeleteMountPointEntry delete_mount_point = 9;
    InodeDirectoryEntry inode_directory = 10;
    InodeDirectoryIdGeneratorEntry inode_directory_id_generator = 11;
    InodeFileEntry inode_file_entry = 12;
    InodeLastModificationTimeEntry inode_last_modification_time = 13;
    LineageEntry lineage = 14;
    LineageIdGeneratorEntry lineage_id_generator = 15;
    PersistDirectoryEntry persist_directory = 16;
    PersistFileEntry persist_file = 17;
    PersistFilesEntry persist_files = 18;
    PersistFilesRequestEntry persist_files_request = 19;
    RawTableEntry raw_table = 20;
    ReinitializeFileEntry reinitialize_file = 21;
    RenameEntry rename = 22;
    SetStateEntry set_state = 23;
    UpdateMetadataEntry update_metadata = 24;
  }
}

// next available id: 3
message AddMountPointEntry {
  optional string tachyon_path = 1;
  optional string ufs_path = 2;
}

// next available id: 2
message AsyncCompleteFileEntry {
  optional int64 file_id = 1;
}

// next available id: 2
message BlockContainerIdGeneratorEntry {
  optional int64 next_container_id = 1;
}

// next available id: 3
message BlockInfoEntry {
  optional int64 block_id = 1;
  optional int64 length = 2;
}

// next available id: 5
message CompleteFileEntry {
  repeated int64 block_ids = 1;
  optional int64 id = 2;
  optional int64 length = 3;
  optional int64 op_time_ms = 4;
}

// next available id: 4
message DeleteFileEntry {
  optional int64 id = 1;
  optional bool recursive = 2;
  optional int64 op_time_ms = 3;
}

// next available id: 3
message DeleteLineageEntry {
  optional int64 lineage_id = 1;
  optional bool cascade = 2;
}

// next available id: 2
message DeleteMountPointEntry {
  optional string tachyon_path = 1;
}

// next available id: 8
message InodeDirectoryEntry {
  optional int64 id = 1;
  optional int64 parent_id = 2;
  optional string name = 3;
  optional bool persisted = 4;
  optional bool pinned = 5;
  optional int64 creation_time_ms = 6;
  optional int64 last_modification_time_ms = 7;
}

// next available id: 3
message InodeDirectoryIdGeneratorEntry {
  optional int64 container_id = 1;
  optional int64 sequence_number = 2;
}

// next available id: 14
message InodeFileEntry {
  optional int64 id = 1;
  optional int64 parent_id = 2;
  optional string name = 3;
  optional bool persisted = 4;
  optional bool pinned = 5;
  optional int64 creation_time_ms = 6;
  optional int64 last_modification_time_ms = 7;
  optional int64 block_size_bytes = 8;
  optional int64 length = 9;
  optional bool completed = 10;
  optional bool cacheable = 11;
  repeated int64 blocks = 12;
  optional int64 ttl = 13;
}

// next available id: 3
message InodeLastModificationTimeEntry {
  optional int64 id = 1;
  optional int64 last_modification_time_ms = 2;
}

// next available id: 8
message LineageEntry {
  optional int64 id = 1;
  repeated int64 input_files = 2;
  repeated int64 output_file_ids = 3;
  repeated LineageFileState output_file_states = 4;
  optional string job_command = 5;
  optional string job_output_path = 6;
  optional int64 creation_time_ms = 7;
}

// next available id: 6
enum LineageFileState {
  CREATED = 1;
  COMPLETED = 2;
  PERSISTED = 3;
  PERSISENCE_REQUESTED = 4;
  LOST = 5;
}

// next available id: 2
message LineageIdGeneratorEntry {
  optional int64 sequence_number = 1;
}

// next available id: 1
message PersistDirectoryEntry {
  optional int64 id = 1;
}

// next available id: 4
message PersistFileEntry {
  optional int64 id = 1;
  optional int64 length = 2;
  optional int64 op_time_ms = 3;
}

// next available id: 2
message PersistFilesEntry {
  repeated int64 file_ids = 1;
}

// next available id: 2
message PersistFilesRequestEntry {
  repeated int64 file_ids = 1;
}

// next available id: 4
message RawTableEntry {
  optional int64 id = 1;
  optional int32 columns = 2;
  optional bytes metadata = 3;
}

// next available id: 4
message ReinitializeFileEntry {
  optional string path = 1;
  optional int64 block_size_bytes = 2;
  optional int64 ttl = 3;
}

// next available id: 4
message RenameEntry {
  optional int64 id = 1;
  optional string dst_path = 2;
  optional int64 op_time_ms = 3;
}

// next available id: 6
message SetStateEntry {
  optional int64 id = 1;
  optional int64 op_time_ms = 2;
  optional bool pinned = 3;
  optional int64 ttl = 4;
  optional bool persisted = 5;
}

// next available id: 3
message UpdateMetadataEntry {
  optional int64 id = 1;
  optional bytes metadata = 2;
}
