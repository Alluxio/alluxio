#!/bin/bash
set -e
# clean up environment
rm -rf files

vagrant up --provider=aws --no-provision

# generate key
if [ ! -f files/id_rsa ]
then
    ssh-keygen -f files/id_rsa -t rsa -N ''
# ssh without password
    cat files/id_rsa.pub |awk '{print $1, $2, "Generated by vagrant"}' > files/authorized_keys2
    cat files/id_rsa.pub |awk '{print $1, $2, "Generated by vagrant"}' > files/authorized_keys
fi

vagrant provision